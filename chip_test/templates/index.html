<!DOCTYPE html>
<html>
<head>
    <title>6x6 Chess Game</title>
    <style>
        .board {
            display: inline-block;
            border: 2px solid #333;
        }
        .row {
            display: flex;
        }
        .cell {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        .white-cell {
            background-color: #fff;
        }
        .black-cell {
            background-color: #ccc;
        }
        .piece {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }
        .black {
            background-color: #000;
        }
        .white {
            background-color: #fff;
            border: 2px solid #000;
        }
        .selected {
            background-color: #ffeb3b;
        }
        .valid-move {
            background-color: #4caf50;
        }
    </style>
</head>
<body>
    <div id="game">
        <h2 id="turn-display">Current Turn: White</h2>
        <div class="board" id="chess-board"></div>
    </div>

    <script>
        let selectedPiece = null;
        let validMoves = [];

        function createBoard() {
            const board = document.getElementById('chess-board');
            for (let i = 0; i < 6; i++) {
                const row = document.createElement('div');
                row.className = 'row';
                for (let j = 0; j < 6; j++) {
                    const cell = document.createElement('div');
                    cell.className = `cell ${(i + j) % 2 === 0 ? 'white-cell' : 'black-cell'}`;
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.addEventListener('click', handleCellClick);
                    row.appendChild(cell);
                }
                board.appendChild(row);
            }
        }

        function updateBoard(boardState) {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                cell.innerHTML = '';
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                if (boardState[row][col]) {
                    const piece = document.createElement('div');
                    piece.className = `piece ${boardState[row][col]}`;
                    cell.appendChild(piece);
                }
            });
        }

        function highlightValidMoves(moves) {
            document.querySelectorAll('.valid-move').forEach(cell => {
                cell.classList.remove('valid-move');
            });
            moves.forEach(([row, col]) => {
                const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                cell.classList.add('valid-move');
            });
        }

        async function handleCellClick(event) {
            const row = parseInt(event.currentTarget.dataset.row);
            const col = parseInt(event.currentTarget.dataset.col);
            
            if (selectedPiece === null) {
                const response = await fetch('/select_piece', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ row, col }),
                });
                const data = await response.json();
                
                if (data.status === 'success') {
                    selectedPiece = [row, col];
                    validMoves = data.valid_moves;
                    event.currentTarget.classList.add('selected');
                    highlightValidMoves(validMoves);
                }
            } else {
                const response = await fetch('/move_piece', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ row, col }),
                });
                const data = await response.json();
                
                if (data.status === 'success') {
                    updateBoard(data.board);
                    document.getElementById('turn-display').textContent = 
                        `Current Turn: ${data.board[row][col] === 'black' ? 'White' : 'Black'}`;
                }
                
                document.querySelector('.selected')?.classList.remove('selected');
                highlightValidMoves([]);
                selectedPiece = null;
                validMoves = [];
            }
        }

        async function initGame() {
            createBoard();
            const response = await fetch('/get_board');
            const data = await response.json();
            updateBoard(data.board);
        }

        initGame();
    </script>
</body>
</html>